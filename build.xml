<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : build.xml
    Created on : 08 November 2009, 19:07
    Author     : Linus Norton <linusnorton@gmail.com>
    Description:
        This file contains the phing scripts to test and deploy an xframe project
-->


<project name="testsite" basedir="." default="deploy">
    <property file="./config/xframe.conf" />

    <!-- Deploy -->
    <target name="deploy" description="deploy the project">
        <!--this is hardcoded to mysql until I find a better way-->
        <exec command="mysql -h${DATABASE_HOST} -u${DATABASE_USERNAME} -p${DATABASE_PASSWORD} -e'DROP DATABASE IF EXISTS ${DATABASE_NAME}; CREATE DATABASE ${DATABASE_NAME}'"
              dir="."
              checkreturn="true" />

        <pdo url="${DATABASE_ENGINE}:host=${DATABASE_HOST};dbname=${DATABASE_NAME}" userid="${DATABASE_USERNAME}" password="${DATABASE_PASSWORD}">
          <fileset dir="install">
              <include name="*.sql"/>
          </fileset>
        </pdo>

    </target>

    <!-- Test -->
    <target depends="deploy" name="test" description="tests this package">

        <phpunit printsummary="true" codecoverage="true">          
          <batchtest>
            <fileset dir="test">
              <include name="**/*Test*.php"/>
            </fileset>
          </batchtest>
          <!--<formatter type="xml" todir="report" outfile="logfile.xml"/>-->
        </phpunit>

        <phpunitreport infile="report/logfile.xml"
                       styledir="/usr/lib/php/data/phing/etc"
                       format="frames"
                       todir="report"/>


        <coverage-report outfile="coverage-report/coverage.xml">
            <report styledir="/usr/lib/php/data/phing/etc"
                    todir="coverage-report"/>
        </coverage-report>

    </target>
</project>




